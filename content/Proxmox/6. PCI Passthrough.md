---
title: 6. PCI Passthrough
draft: false
tags:
---
 
Assuming your CPU is intel. Edit the following in grub.

```
nano /etc/default/grub
```

Edit "GRUB_CMDLINE_LINUX_DEFAULT=" to this line below exactly.

```
GRUB_CMDLINE_LINUX_DEFAULT="quiet intel_iommu=on"
```

 Run the command update-grub to finalize changes.

```
update-grub
```

Reboot your Proxmox server

â€‹Verify IOMMU has been enabled.

```
dmesg | grep -e DMAR -e IOMMU
```

You should find the following:

```
DMAR: IOMMU enabled
```

Run the command to check if the SATA controller is in its own IOMMU group:

```
ls -al /sys/block/sd*
```

In case the ID ends in anything other than .0 the IMMOU group is shared. To solved this you need to install the card in the CPU PCI-E slot. Cheap consumer motherboards have all chipset PCI-E slots shared.

![](proxmox_pci_iommu_group.png)

Using the following command you can see the main device.

```
#!/bin/bash
for d in $(find /sys/kernel/iommu_groups/ -type l | sort -n -k5 -t/); do 
    n=${d#*/iommu_groups/*}; n=${n%%/*}
    printf 'IOMMU Group %s ' "$n"
    lspci -nns "${d##*/}"
done;
```

![](proxmox_pci_iommu_shared_2.png)

After switching the device to the correct PCI-E slot, it now shows correctly.

